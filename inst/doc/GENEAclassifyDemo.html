<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Activinsights Ltd" />

<meta name="date" content="2017-08-22" />

<title>GENEAclassifyDemo</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />




</head>

<body>




<h1 class="title toc-ignore">GENEAclassifyDemo</h1>
<h4 class="author">Activinsights Ltd</h4>
<h4 class="date">22 August 2017</h4>



<div id="geneaclassify" class="section level1">
<h1>GENEAclassify</h1>
<div id="overview" class="section level2">
<h2>Overview</h2>
<p>GENEActiv is the original wrist-worn, raw data accelerometer for objective behavioural measurement. The accelerometer watches lead the way for the next generation of affordable waveform output accelerometers. The watches are the perfect tool for analysing human behaviour, from studying the impact of physical activity on health and lifestyle to sports science and vehicle safety. The device is an ergonomic body worn instrument:</p>
<ul>
<li>waterproof,</li>
<li>robust to moderate impacts,</li>
<li>contains a precision real-time clock,</li>
<li>runs from a long-lasting, rechargeable battery,</li>
<li>storage for 500 MB of binary data.</li>
</ul>
<p>The package GENEAread provides data import functionality, giving researchers access to cutting edge analytical tools from the R environment. Imported data can be summarized by a segmentation process which cuts the dataset into time periods of characteristically similar behaviour. The activities in each segment can be guessed by an rpart GENEA classification tree. A sample rpart GENEA classification tree, trainingFit, is provided with GENEAclassify. This package provides classification tools, allowing researchers to segment training data and create custom classification trees. For best results, you will need to collect some training data for the activities that you expect your users to perform, label the appropriate segments, and create a new classification tree. Training data is data captured by the GENEActiv accelerometer during expected behaviours of your study participants, such as sleeping, sitting or running. To train the classification tree, ask a sample of your participants to wear the accelerometer and perform specific activities. These can be used to classify field data into behaviours of interest, to automatically process raw output into complete diary histories.</p>
</div>
<div id="summary" class="section level2">
<h2>Summary</h2>
<p>There are multiple ways in which GENEAclassify can be used to understand your GENEActiv data. The analysis flow is typically:</p>
<ul>
<li>import GENEActiv bin file training data,</li>
<li>segment and summarize training data,</li>
<li>manually classify training data segments,</li>
<li>creating an rpart GENEA fit from training data,</li>
<li>import GENEActiv bin file test data,</li>
<li>segment and summarize test data,</li>
<li>apply rpart GENEA fit to segmented test data.</li>
</ul>

</div>
</div>
<div id="contents" class="section level1">
<h1>Contents</h1>
<ol style="list-style-type: decimal">
<li>Introduction and Installation.
<ol style="list-style-type: lower-roman">
<li><pre><code>  Preface</code></pre></li>
<li><pre><code>  Installing R.</code></pre></li>
<li><pre><code>  Using GENEAclassifiyDemonstration.R </code></pre></li>
<li><pre><code>  Installing and loading required libraries</code></pre></li>
<li><pre><code>  Installing GENEAclassify</code></pre></li>
</ol></li>
<li>Segmentation
<ol style="list-style-type: lower-roman">
<li><pre><code>  Introduction</code></pre></li>
<li><pre><code>  Loading Data</code></pre></li>
<li><pre><code>  Segmenting Data</code></pre></li>
<li><pre><code>  Varying Step Counting Algorithms</code></pre></li>
<li><pre><code>  Feature Development</code></pre></li>
</ol></li>
<li>Applying a Classification Model
<ol style="list-style-type: lower-roman">
<li><pre><code>  Introduction</code></pre></li>
<li><pre><code>  Creating a classification model form Training Data</code></pre></li>
<li><pre><code>  Classifying a file</code></pre></li>
<li><pre><code>  Classifying a directory</code></pre></li>
</ol></li>
<li>Creating a Classification Model
<ol style="list-style-type: lower-roman">
<li><pre><code>  Introduction</code></pre></li>
<li><pre><code>  Manually Classifying files</code></pre></li>
<li><pre><code>  Creating a Training Data set</code></pre></li>
</ol></li>
<li>Development of GENEAclassify (Do we want to add this?)
<ol style="list-style-type: lower-roman">
<li><pre><code>  Github Repository </code></pre></li>
<li><pre><code>  Making Changes (Forking)</code></pre></li>
</ol></li>
</ol>

</div>
<div id="introduction-and-installation." class="section level1">
<h1>1. Introduction and Installation.</h1>
<div id="i.-preface" class="section level2">
<h2>i. Preface</h2>
<p>This pdf file will give an introduction to using the programming language R with the package GENEAclassify which has been provided in a zip folder. The following steps will provide the user with the tools to use the package before running through the script. Please ensure that the folder has been decompressed. The folder found from the Dropbox link should contain the following:</p>
<ul>
<li>GENEAclassify_1.4.1.tar.gz</li>
<li>GENEAclassifyDemonstration.R</li>
<li>TrainingData (folder containing sample training data)</li>
<li>TrainingData.csv (A larger training data set)</li>
<li>RunWalk.bin (A sample .bin file)</li>
</ul>
</div>
<div id="ii.-installing-r." class="section level2">
<h2>ii. Installing R.</h2>
<pre><code>To begin with install R from &lt;https://www.r-project.org&gt;. </code></pre>
<p>There is an introduction to the R environment here <a href="https://cran.r-project.org/doc/manuals/r-release/R-intro.pdf" class="uri">https://cran.r-project.org/doc/manuals/r-release/R-intro.pdf</a> that would familiarize a user. I would also recommend downloading the IDE (integrated development environment) RStudio from <a href="https://www.rstudio.com/products/rstudio/" class="uri">https://www.rstudio.com/products/rstudio/</a> after you have installed R. RStudio provides the user with more than the console to work with and gives the option of having a script, console, view of the R environment and file locations in one window. There is a list of tips here on using RStudio here <a href="https://www.rstudio.com/resources/cheatsheets/" class="uri">https://www.rstudio.com/resources/cheatsheets/</a>.</p>
<p>Ctrl-R or Cmd-Ent runs the line that the cursor is on or you can simply copy and paste the line of code into the console</p>
<p>Note: (You will also need to install x11 forward <a href="https://www.xquartz.org/" class="uri">https://www.xquartz.org/</a> to run on OS.)</p>
</div>
<div id="iii.-using-geneaclassifiydemonstration.r" class="section level2">
<h2>iii. Using GENEAclassifiyDemonstration.R</h2>
<p>throughout this tutorial commands are shown and briefly explained which are to be entered into the console. If you open the script GENEAclassifyDemostration.R (which is in the zip folder) you will find a detailed and commented script that you can work through, running each line at a time and making appropriate changes to get the results desired. This pdf runs through that script giving further explanation. Please remember that R is a case sensitive language.</p>
<div id="the-script-provided-will-run-through-these-steps" class="section level5">
<h5>The script provided will run through these steps:</h5>
<ol style="list-style-type: lower-alpha">
<li>Installing and loading required libraries</li>
<li>Installing GENEAclassify</li>
<li>Loading in a data file/directory to segment</li>
<li>Loading a training data set</li>
<li>Creating the classification model from the Training Data</li>
<li>Classifying a file</li>
<li>Classifying a directory</li>
<li>Setting up the step counting algorithm</li>
<li>Varying Step Counting algorithms</li>
<li>Manually Classifying files</li>
<li>Creating a Training data set</li>
</ol>
<p>However the code shown in this PDF can be copied and pasted into the console.</p>
</div>
</div>
<div id="iv.-installing-and-loading-required-libraries" class="section level2">
<h2>iv. Installing and loading required libraries</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="st">&quot;GENEAread&quot;</span>,<span class="dt">repos =</span> <span class="st">&quot;http://cran.us.r-project.org&quot;</span>) 
<span class="kw">install.packages</span>(<span class="st">&quot;changepoint&quot;</span>,<span class="dt">repos =</span> <span class="st">&quot;http://cran.us.r-project.org&quot;</span>)
<span class="kw">install.packages</span>(<span class="st">&quot;signal&quot;</span>,<span class="dt">repos =</span> <span class="st">&quot;http://cran.us.r-project.org&quot;</span>)
<span class="kw">install.packages</span>(<span class="st">&quot;mmap&quot;</span>,<span class="dt">repos =</span> <span class="st">&quot;http://cran.us.r-project.org&quot;</span>)

<span class="co"># Load in the libraries</span>
<span class="kw">library</span>(GENEAread)
<span class="kw">library</span>(changepoint)
<span class="kw">library</span>(signal)
<span class="kw">library</span>(mmap)</code></pre></div>
</div>
<div id="v.-installing-geneaclassify" class="section level2">
<h2>v. Installing GENEAclassify</h2>
<p>Whilst GENEAclassify is still in development the easiest way to install the package is to use the Tar.gz file inside the zip folder. By running the code below GENEAclassify can be installed:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># You will need to change the folder location inside setwd(&quot;&quot;) to the directory where you saved the tar.gz file</span>
<span class="co"># Note that R only uses / not \ when refering to a file/directory location</span>
<span class="kw">setwd</span>(<span class="st">&quot;/Users/owner/Documents/GENEActiv&quot;</span>) 
<span class="kw">install.packages</span>(<span class="st">&quot;GENEAclassify_1.4.3.tar.gz&quot;</span>, <span class="dt">repos=</span><span class="ot">NULL</span>, <span class="dt">type=</span><span class="st">&quot;source&quot;</span>)</code></pre></div>
<p>Once the package has been installed load in the library</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(GENEAclassify)</code></pre></div>
</div>
<div id="vi.-development-of-geneaclassify-on-github." class="section level2">
<h2>vi. Development of GENEAclassify on GitHub.</h2>
<p>If you intend on working with the development of the package then I suggest setting up an account on GitHub here <a href="https://github.com/" class="uri">https://github.com/</a>. RStudio can directly link to the repository for the development of the package by selecting to set-up a new project from the top right hand corner, selecting version control and cloning the GitHub repository.</p>
<p>This guide on using RStudio with GitHub is particularly helpful <a href="http://www.r-bloggers.com/rstudio-and-github/" class="uri">http://www.r-bloggers.com/rstudio-and-github/</a>.</p>
<p>Once GitHub has been set-up I would recommend creating a personal branch for contributions which can be assessed and discussed by Activinsights before adding any changes to the master repository.</p>
<p>To use GitHub for development on windows, R tools will have to be downloaded from this link:</p>
<ul>
<li><a href="https://cran.r-project.org/bin/windows/Rtools/index.html" class="uri">https://cran.r-project.org/bin/windows/Rtools/index.html</a></li>
</ul>
<p>and a latex compiler found here:</p>
<ul>
<li><a href="http://miktex.org/download" class="uri">http://miktex.org/download</a>.</li>
</ul>
<p>For OS, xcode developer tools will have to be downloaded from this link:</p>
<ul>
<li><a href="http://itunes.apple.com/us/app/xcode/id497799835?mt=12" class="uri">http://itunes.apple.com/us/app/xcode/id497799835?mt=12</a></li>
</ul>
<p>and a latex compiler found here:</p>
<ul>
<li><a href="http://www.tug.org/mactex/downloading.html" class="uri">http://www.tug.org/mactex/downloading.html</a>.</li>
</ul>
<p>For more information go to <a href="http://www.activinsights.com/" class="uri">http://www.activinsights.com/</a>.</p>
<p>The package can also be installed using a GitHub authentication key which will go in the “” of auth_token. The key will be provided on request. The package devtools is also required to install from GitHub.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="st">&quot;devtools&quot;</span>,<span class="dt">repos =</span> <span class="st">&quot;http://cran.us.r-project.org&quot;</span>) 
<span class="kw">library</span>(devtools) 

<span class="kw">install_github</span>(<span class="st">&quot;https://github.com/Langford/GENEAclassify_1.41.git&quot;</span>,
               <span class="dt">auth_token =</span> <span class="st">&quot;7f0051aaca453eaabf0e60d49bcf752c0fea0668&quot;</span>)</code></pre></div>
<p>Again loading in the package to the workspace.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(GENEAclassify)</code></pre></div>
<p>This vignette can be viewed from inside R by running the following code</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">vignette</span>(<span class="st">&quot;GENEAclassifyDemo&quot;</span>, <span class="dt">package =</span> <span class="ot">NULL</span>, <span class="dt">lib.loc =</span> <span class="ot">NULL</span>, <span class="dt">all =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p>The pdf will appear on the right of RStudio or as a pop up if called from R.</p>
</div>
</div>
<div id="segmentation" class="section level1">
<h1>2. Segmentation</h1>
<div id="i.-introduction." class="section level2">
<h2>i. Introduction.</h2>
<p>The Segmentation process gives the user event based data from a change point analysis. The function determines when the statistical properties of the data have changed and hence the observed behaviour has also changed. This following section gives demonstrations on how this works given the GENEA .bin data.</p>
</div>
<div id="ii.-loading-data" class="section level2">
<h2>ii. Loading Data</h2>
<p>Now that we have the libraries required to segment and classify files/directories the data needs to be imported. Beginning with a file to import run the following lines of code.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"> <span class="co"># Name of the file to analyse</span>
DataFile =<span class="st"> &quot;DataDirectory/jl_left wrist_010094_2012-01-30 20-39-54.bin&quot;</span> 
ImportedData =<span class="st"> </span><span class="kw">dataImport</span>(DataFile, <span class="dt">downsample =</span> <span class="dv">100</span>, <span class="dt">start=</span><span class="dv">0</span>, <span class="dt">end=</span><span class="fl">0.1</span>)
<span class="kw">head</span>(ImportData)</code></pre></div>
<p>The start and end times can be set using values between 0 and 1 or using a 24 hour character string (time inside “”). The former divides the file into sections specified. For example if you have 10 days of data this might be useful. A 24 hour character string e.g start = “1 3:00”,end =“2 3:00”.The 1 represents the day and the time uses a 24 hour format. Ensure you leave a space between the days and the time.</p>
<p>The output from the command head(ImportData) shows the variables calculated from importing the data.</p>
<p>The variable Downsample gives the user the option to compress the data to make the process less computationally heavy. This has a default value of 100 but can be made smaller to allow a higher resolution, although this will take longer to run.</p>
</div>
<div id="iii.-segmenting-data." class="section level2">
<h2>iii. Segmenting Data.</h2>
<p>After loading this data, the segmentation can be applied. There are currently two methods of change point analysis within the package. the variable <em>changepoint</em> controls which analysis to perform. “UpDownDegrees” will perform a change point analysis based on the variance of arm elevation and wrist rotation. The analysis uses the function <em>cpt.var</em> from the package <em>changepoint</em> on both datasets before merging the two. This is the default analysis and is best for detecting posture change. The second analysis is performed on the variance of Temperature and Frequency called changepoint = “TempFreq”. This analysis is better for determining changes during sleep.</p>
<p>The output of the function is created by taking raw data and returning calculated variables. These variables can be viewed using the function <em>head</em>.</p>
<p>The variable DataCols can be added to find extra variables given the use of functions within R or the ones provided by GENEAclassify. These include GENEAskew, GENEAenergy, GENEAcount, GENEAratio and any suffix found in the code below. To find more information on these functions use the ? before the function in question. For example ?GENEAenergy will provide details on that function in the help window of RStudio or as a pop-up.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># These are the default output variables from segmentation and getGENEAsegments</span>
 dataCols &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;UpDown.mean&quot;</span>,
                <span class="st">&quot;UpDown.var&quot;</span>,
                <span class="st">&quot;UpDown.sd&quot;</span>,
                <span class="st">&quot;Degrees.mean&quot;</span>,
                <span class="st">&quot;Degrees.var&quot;</span>,
                <span class="st">&quot;Degrees.sd&quot;</span>,
                <span class="st">&quot;Magnitude.mean&quot;</span>,
                <span class="co"># Frequency Variables</span>
                <span class="st">&quot;Principal.Frequency.median&quot;</span>,
                <span class="st">&quot;Principal.Frequency.mad&quot;</span>,
                <span class="st">&quot;Principal.Frequency.GENEAratio&quot;</span>,
                <span class="st">&quot;Principal.Frequency.sumdiff&quot;</span>,
                <span class="st">&quot;Principal.Frequency.meandiff&quot;</span>,
                <span class="st">&quot;Principal.Frequency.abssumdiff&quot;</span>,
                <span class="st">&quot;Principal.Frequency.sddiff&quot;</span>,
                <span class="co"># Light Variables</span>
                <span class="st">&quot;Light.mean&quot;</span>, 
                <span class="st">&quot;Light.max&quot;</span>,
                <span class="co"># Temperature Variables</span>
                <span class="st">&quot;Temp.mean&quot;</span>,
                <span class="st">&quot;Temp.sumdiff&quot;</span>,
                <span class="st">&quot;Temp.meandiff&quot;</span>,
                <span class="st">&quot;Temp.abssumdiff&quot;</span>,
                <span class="st">&quot;Temp.sddiff&quot;</span>,
                <span class="co"># Step Variables</span>
                <span class="st">&quot;Step.GENEAcount&quot;</span>, 
                <span class="st">&quot;Step.sd&quot;</span>,
                <span class="st">&quot;Step.mean&quot;</span>)

<span class="co"># Performing the segmentation now given the dataCols we want to find.</span>

SegDataFile =<span class="st"> </span><span class="kw">segmentation</span>(ImportedData, dataCols)
<span class="co"># View the data from the segmentation</span>
<span class="kw">head</span>(SegDataFile)</code></pre></div>
<p><em>getGENEAsegments</em> combines the functions <em>dataImport</em> and <em>segmentation</em>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"> <span class="co"># Name of the file to analyse</span>
DataFile =<span class="st"> &quot;DataDirectory/jl_left wrist_010094_2012-01-30 20-39-54.bin&quot;</span> 
SegDataFile =<span class="st"> </span><span class="kw">getGENEAsegments</span>(DataFile,dataCols, <span class="dt">start=</span><span class="dv">0</span>, <span class="dt">end=</span><span class="fl">0.1</span>)</code></pre></div>
</div>
<div id="iv.-varying-step-counting-algorithms." class="section level2">
<h2>iv. Varying Step Counting Algorithms.</h2>
<p>The segmentation function also applies a default step counting algorithm when no arguments are passed through the function. The step counting algorithm works by combining the x and z series together, filtering this signal and counting the zero crossing over a given window.</p>
<p>There are then 4 separate methods for calculating the number of steps (Step.GENEAcount),the standard deviation of those steps (Step.sd) and the steps per minute (Step.mean).</p>
<p>By changing the method between “Butterfilter”,“Chebyfilter”,“longrun” and “none” the difference in the values can be seen in the following code and by adapting the various parameters that are used in each method varying step counting algorithms can be created.</p>
<ul>
<li>“Butterfilter” takes the xz series and applies a butterworth filter from the signal R package. To understand all the parameters that can be set when using the butterworth filter please look at signal package for more details.</li>
<li>“Chebyfilter” uses the cheby1 filter from the signal package. Please refer to the signal package to understand the variables that can be passed to this function.</li>
<li>“longrun” takes a running mean over a set window length, smlen, and counts the 0s on this.</li>
<li>“none” does not use any filtering.</li>
</ul>
<p>The default settings use the method “Chebyfilter” which applies a Chebyshev filter which uses filterorder = 4, boundaries = c(0.15, 1.0), Rp = 0.5. The window used to count the zero crossings is set to smlen = 20.</p>
<p>However this window can be made variable by setting <em>STFT = TRUE</em> which finds the median principal frequency of the segment and assigns the window based on the frequency of the movements found.</p>
<p>plot.it = FALSE is the default setting but if set to TRUE the function creates a plot which shows where the step counter has determined steps to have occurred within each segment found.</p>
<p>Centre = TRUE centres the xz signal given about 0 by subtracting the mean of the signal from itself.</p>
<p>To view all of the arguments that can be passed to the function <em>stepCounter</em> inside <em>getGENEAsegments</em> run the line ?stepCounter</p>
<p>The following commands give examples from the training data provided</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">WalkingData=<span class="st">&quot;TrainingData/Walking/walking_jl_right wrist_024603_2015-12-12 15-36-47.bin&quot;</span>

<span class="co"># Starting with no filter</span>
W1 =<span class="st"> </span><span class="kw">getGENEAsegments</span>(WalkingData, <span class="dt">method=</span><span class="st">&quot;none&quot;</span>, <span class="dt">plot.it=</span><span class="ot">TRUE</span>) 
<span class="co"># plot.it Shows the crossing points. Turn this on for all plots to see how each filter works</span>
<span class="co"># List the step outputs here. </span>
W1<span class="op">$</span>Step.GENEAcount;W1<span class="op">$</span>Step.sd;W1<span class="op">$</span>Step.mean

<span class="co"># Using the default longrun</span>
W2 =<span class="st"> </span><span class="kw">getGENEAsegments</span>(WalkingData, <span class="dt">method=</span><span class="st">&quot;longrun&quot;</span>)
W2<span class="op">$</span>Step.GENEAcount;W2<span class="op">$</span>Step.sd;W2<span class="op">$</span>Step.mean

<span class="co"># Using long run again with a different window length. The default smlen=20.</span>
W2 =<span class="st"> </span><span class="kw">getGENEAsegments</span>(WalkingData, <span class="dt">method=</span><span class="st">&quot;longrun&quot;</span>,<span class="dt">smlen=</span><span class="dv">30</span>)
W2<span class="op">$</span>Step.GENEAcount;W2<span class="op">$</span>Step.sd;W2<span class="op">$</span>Step.mean

<span class="co"># Using the cheby filter options</span>
W3 =<span class="st"> </span><span class="kw">getGENEAsegments</span>(WalkingData, <span class="dt">method=</span><span class="st">&quot;Chebyfilter&quot;</span>,<span class="dt">smlen=</span><span class="dv">50</span>)
W3<span class="op">$</span>Step.GENEAcount;W3<span class="op">$</span>Step.sd;W3<span class="op">$</span>Step.mean

<span class="co"># Changing the Rp value as seen in the signal package (defualt Rp = 20)</span>
W3 =<span class="st"> </span><span class="kw">getGENEAsegments</span>(WalkingData, <span class="dt">method=</span><span class="st">&quot;Chebyfilter&quot;</span>, <span class="dt">smlen =</span> <span class="dv">50</span>, <span class="dt">Rp =</span> <span class="fl">0.01</span>)
W3<span class="op">$</span>Step.GENEAcount;W3<span class="op">$</span>Step.sd;W3<span class="op">$</span>Step.mean

<span class="co"># Using the Butterworth filter </span>
W4 =<span class="st"> </span><span class="kw">getGENEAsegments</span>(WalkingData, <span class="dt">method=</span><span class="st">&quot;Butterfilter&quot;</span>,<span class="dt">smlen=</span><span class="dv">50</span>,<span class="dt">Rp=</span><span class="fl">0.01</span>)
W4<span class="op">$</span>Step.GENEAcount;W4<span class="op">$</span>Step.sd;W4<span class="op">$</span>Step.mean

<span class="co"># Using the Butterworth filter and changing the boundaries (Default: boundaries = c(0.15, 1.0))</span>
W4 =<span class="st"> </span><span class="kw">getGENEAsegments</span>(WalkingData, <span class="dt">method=</span><span class="st">&quot;Butterfilter&quot;</span>,<span class="dt">boundaries =</span> <span class="kw">c</span>(<span class="fl">0.15</span>, <span class="fl">0.5</span>),
                      <span class="dt">smlen=</span><span class="dv">50</span>,<span class="dt">Rp=</span><span class="fl">0.01</span>)
W4<span class="op">$</span>Step.GENEAcount;W4<span class="op">$</span>Step.sd;W4<span class="op">$</span>Step.mean</code></pre></div>
</div>
</div>
<div id="applying-a-classification-model" class="section level1">
<h1>3. Applying a Classification Model</h1>
<div id="i.-introduction" class="section level2">
<h2>i. Introduction</h2>
<p>Once the data has been segmented a classification model can be used to classify each segment as an activity.</p>
<p>A classification model takes a set of training data that has been classified previously to form a decision tree using the <em>rpart</em> package and function, given the features from the segmentation function. This model can then be applied to the segmented data to classify individual behaviours/activities provided by the training data set.</p>
</div>
<div id="ii.-creating-a-classification-model-from-training-data" class="section level2">
<h2>ii. Creating a classification model from Training Data</h2>
<p>There is a .csv file that contains a training data set located inside the zip folder, called TrainingData.csv. This model contains a comprehensive amount of classified data which can be used to create a classification model. To load the data in please use the following lines:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Change the file path to the location of GENEAclassify.</span>
<span class="kw">setwd</span>(<span class="st">&quot;/Users/owner/Documents/GENEActiv/GENEAclassify_1.41/Data&quot;</span>) 
TrainingData=<span class="kw">read.table</span>(<span class="st">&quot;TrainingData.csv&quot;</span>,<span class="dt">sep=</span><span class="st">&quot;,&quot;</span>)

<span class="co"># The data can also be called through from the package. </span>
<span class="kw">data</span>(TrainingData)
TrainingData</code></pre></div>
<p>Now the Training Data can be used to create a classification model. All of the features have been listed here but some can be removed to refine the model.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ClassificationModel=<span class="kw">createGENEAmodel</span>(TrainingData,
                   <span class="dt">features=</span><span class="kw">c</span>(<span class="st">&quot;Segment.Duration&quot;</span>,<span class="st">&quot;UpDown.mean&quot;</span>,
                              <span class="st">&quot;UpDown.sd&quot;</span>,<span class="st">&quot;Degrees.mean&quot;</span>,
                              <span class="st">&quot;Degrees.sd&quot;</span>,<span class="st">&quot;Magnitude.mean&quot;</span>,<span class="st">&quot;Light.mean&quot;</span>,
                              <span class="st">&quot;Temp.mean&quot;</span>,<span class="st">&quot;Step.sd&quot;</span>,
                              <span class="st">&quot;Step.count&quot;</span>,<span class="st">&quot;Step.mean&quot;</span>,
                              <span class="st">&quot;Principal.Frequency.median&quot;</span>
                             ,<span class="st">&quot;Principal.Frequency.mad&quot;</span>))</code></pre></div>
<p>By removing the features Segment.Duration, Light.mean, Temp.mean and Step.Count an improved model can be created. These features have been removed because of ambiguity when making decisions on what activity a segment is.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ClassificationModel=<span class="kw">createGENEAmodel</span>(TrainingData,
                   <span class="dt">features=</span><span class="kw">c</span>(<span class="st">&quot;UpDown.mean&quot;</span>,
                              <span class="st">&quot;UpDown.sd&quot;</span>,<span class="st">&quot;Degrees.mean&quot;</span>,
                              <span class="st">&quot;Degrees.sd&quot;</span>,<span class="st">&quot;Magnitude.mean&quot;</span>,
                              <span class="st">&quot;Step.sd&quot;</span>,<span class="st">&quot;Step.mean&quot;</span>,
                              <span class="st">&quot;Principal.Frequency.median&quot;</span>
                             ,<span class="st">&quot;Principal.Frequency.mad&quot;</span>))</code></pre></div>
<p>Once the model has been created files can be classified using the function <em>classifyGENEA</em>.</p>
</div>
<div id="iii.-classifying-a-file" class="section level2">
<h2>iii. Classifying a file</h2>
<p>The function classifyGENEA segments a file/directory and uses the Classification model provided to classify each segment as an activity. Select a .bin file to classify and run the following lines. The start and end times work the same as the function <em>getGENEAsegments</em>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">DataFile=<span class="st">&quot;jl_left wrist_010094_2012-01-30 20-39-54.bin&quot;</span> <span class="co"># Change to the file to classify</span>
ClassifiedFile =<span class="st"> </span><span class="kw">classifyGENEA</span>(DataFile, 
                               <span class="dt">trainingfit =</span> ClassificationModel, 
                               <span class="dt">start=</span><span class="st">&quot;3:00&quot;</span>,<span class="dt">end=</span><span class="st">&quot;1 3:00&quot;</span>)</code></pre></div>
</div>
<div id="iv.-classifying-a-directory" class="section level2">
<h2>iv. Classifying a directory</h2>
<p>To classify a directory the DataDirectory has to be selected one day for every data file in the data Directory.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ClassifiedDirectory =<span class="st"> </span><span class="kw">classifyGENEA</span>(DataDirectory, 
                                    <span class="dt">trainingfit =</span> ClassificationModel,
                                    <span class="dt">start=</span><span class="st">&quot;3:00&quot;</span>, <span class="dt">end=</span><span class="st">&quot;1 3:00&quot;</span>)</code></pre></div>
</div>
</div>
<div id="creating-a-classification-model" class="section level1">
<h1>4. Creating a Classification Model</h1>
<div id="i.-introduction-1" class="section level2">
<h2>i. Introduction</h2>
<p>There are two ways to classify files; Automatically using a classification model or manually. To manually classify a file in R a list can be created for each segment then added to the data in the environment. Taking the run walk file provided in the zip folder which contains raw data of someone running then walking.</p>
</div>
<div id="ii.-manually-classifying-files" class="section level2">
<h2>ii. Manually Classifying files</h2>
<p>Using the default step counting parameters to segment the data and then view the output variables using the function <em>head</em>.</p>
<p>Listing the activities chronologically with respect to the segments shown gives</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Activity=<span class="kw">c</span>(<span class="st">&quot;Running&quot;</span>,
           <span class="st">&quot;Running&quot;</span>,
           <span class="st">&quot;Walking&quot;</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">SegData=<span class="kw">cbind</span>(SegData,ActivitiesListed)</code></pre></div>
<p>Or by classifying each row individually.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">SegData<span class="op">$</span>Activity[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>]=<span class="st">&quot;Running&quot;</span>
SegData<span class="op">$</span>Activity[<span class="dv">3</span>]=<span class="st">&quot;Walking&quot;</span></code></pre></div>
</div>
<div id="iii.-creating-a-training-data-set" class="section level2">
<h2>iii. Creating a Training Data set</h2>
<p>A Training Data set that has been manually classified can be used to create a Training model which can automatically classify files.</p>
<p>To do this the activities that are going to be identified must feature in the training model. Below is a demonstration of how to create a classification model by using the sample training data provided in the zip file.</p>
<p>Running the following lines of code segments each of the .bin files in the sample training data. The second line manually classifies each of the activities which can be used to create the training model. The sample training data has been organised so that the .bin files in each sub folder only contain the activity named.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Cycling=<span class="kw">getSegmentedData</span>(<span class="st">&quot;TrainingData/Cycling&quot;</span>)
Cycling<span class="op">$</span>Activity=<span class="st">&quot;Cycling&quot;</span>

NonWear=<span class="kw">getSegmentedData</span>(<span class="st">&quot;TrainingData/NonWear&quot;</span>)
NonWear<span class="op">$</span>Activity=<span class="st">&quot;NonWear&quot;</span>

onthego=<span class="kw">getSegmentedData</span>(<span class="st">&quot;TrainingData/onthego&quot;</span>)
onthego<span class="op">$</span>Activity=<span class="st">&quot;onthego&quot;</span>

Running=<span class="kw">getSegmentedData</span>(<span class="st">&quot;TrainingData/Running&quot;</span>)
Running<span class="op">$</span>Activity=<span class="st">&quot;Running&quot;</span>

Sitting=<span class="kw">getSegmentedData</span>(<span class="st">&quot;TrainingData/Sitting&quot;</span>)
Sitting<span class="op">$</span>Activity=<span class="st">&quot;Sitting&quot;</span>

Sleep=<span class="kw">getSegmentedData</span>(<span class="st">&quot;TrainingData/Sleep&quot;</span>)
Sleep<span class="op">$</span>Activity=<span class="st">&quot;Sleep&quot;</span>

Standing=<span class="kw">getSegmentedData</span>(<span class="st">&quot;TrainingData/Standing&quot;</span>)
Standing<span class="op">$</span>Activity=<span class="st">&quot;Standing&quot;</span>

Swimming=<span class="kw">getSegmentedData</span>(<span class="st">&quot;TrainingData/Swimming&quot;</span>)
Swimming<span class="op">$</span>Activity=<span class="st">&quot;Swimming&quot;</span>

Transport=<span class="kw">getSegmentedData</span>(<span class="st">&quot;TrainingData/Transport&quot;</span>)
Transport<span class="op">$</span>Activity=<span class="st">&quot;Transport&quot;</span>

Walking=<span class="kw">getSegmentedData</span>(<span class="st">&quot;TrainingData/Walking&quot;</span>)
Walking<span class="op">$</span>Activity=<span class="st">&quot;Walking&quot;</span>

Workingout=<span class="kw">getSegmentedData</span>(<span class="st">&quot;TrainingData/Workingout&quot;</span>)
Workingout<span class="op">$</span>Activity=<span class="st">&quot;Workingout&quot;</span></code></pre></div>
<p>This provides the data required for the classification model. Combining all of these files together using the function <em>rbind</em> to form the training data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">TrainingData=<span class="kw">rbind</span>(Cycling,
                   NonWear,
                   onthego,
                   Running,
                   Sitting,
                   Sleep,
                   Standing,
                   Swimming,
                   Transport,
                   Walking,
                   Workingout)</code></pre></div>
<p>Creating the classification model from this data using the commands from 3ii.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ClassificationModel=<span class="kw">createGENEAFit</span>(TrainingData,
                   <span class="dt">features=</span><span class="kw">c</span>(<span class="st">&quot;UpDown.mean&quot;</span>,
                              <span class="st">&quot;UpDown.sd&quot;</span>,<span class="st">&quot;Degrees.mean&quot;</span>,
                              <span class="st">&quot;Degrees.sd&quot;</span>,<span class="st">&quot;Magnitude.mean&quot;</span>,
                              <span class="st">&quot;Step.sd&quot;</span>,<span class="st">&quot;Step.mean&quot;</span>,
                              <span class="st">&quot;Principal.Frequency.median&quot;</span>,
                              <span class="st">&quot;Principal.Frequency.mad&quot;</span>))</code></pre></div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
